<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Actor State · YAActL.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">YAActL.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../intro/">Introduction</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../actors/">Actors</a></li><li><a class="tocitem" href="../behavior/">Behaviors</a></li><li><a class="tocitem" href="../patterns/">Actor Patterns</a></li></ul></li><li><a class="tocitem" href="../api/">Actor API</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/stack/">A Stack</a></li><li><a class="tocitem" href="../examples/factorial/">A Recursive Factorial</a></li><li><a class="tocitem" href="../examples/state-machines/">State Machines</a></li><li><a class="tocitem" href="../examples/pmap/">Parallel Map</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../messages/">Messages</a></li><li class="is-active"><a class="tocitem" href>Actor State</a><ul class="internal"><li><a class="tocitem" href="#Internal-State"><span>Internal State</span></a></li><li><a class="tocitem" href="#Create-Private-Actor-State"><span>Create Private Actor State</span></a></li><li><a class="tocitem" href="#Update-Actor-State"><span>Update Actor State</span></a></li><li><a class="tocitem" href="#Behavior-Function-Arguments"><span>Behavior Function Arguments</span></a></li><li><a class="tocitem" href="#Global-State"><span>Global State</span></a></li></ul></li><li><a class="tocitem" href="../diagnosis/">Diagnosis</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Actor State</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Actor State</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pbayer/YAActL.jl/blob/master/docs/src/internals.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="state"><a class="docs-heading-anchor" href="#state">Actor State</a><a id="state-1"></a><a class="docs-heading-anchor-permalink" href="#state" title="Permalink"></a></h1><p><code>YAActL</code> follows Julia&#39;s philosophy in giving the user responsibility for access to internals and implementing correct programs:</p><blockquote><p>You are entirely responsible for ensuring that your program is data-race free, and nothing promised here can be assumed if you do not observe that requirement. The observed results may be highly unintuitive. <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></p></blockquote><blockquote><p>When using multi-threading we have to be careful when using functions that are not pure as we might get a wrong answer. <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></p></blockquote><p>Since concurrency is the overarching theme of actor programming and behavior functions must access data to do their job, <a href="https://en.wikipedia.org/wiki/Race_condition#Data_race">data-race</a> freedom is a major concern in working with actors. As a ground rule <strong>actors don&#39;t share state</strong>.</p><h2 id="Internal-State"><a class="docs-heading-anchor" href="#Internal-State">Internal State</a><a id="Internal-State-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-State" title="Permalink"></a></h2><p>Actors have an internal mutable state variable: </p><article class="docstring"><header><a class="docstring-binding" id="YAActL._ACT" href="#YAActL._ACT"><code>YAActL._ACT</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">_ACT(lk::LINK)</code></pre><p>Internal actor status variable.</p><p><strong>Fields</strong></p><ol><li><code>dsp::Dispatch</code>: dispatch mode,</li><li><code>sta::Tuple</code>: the actor&#39;s status variable,</li><li><code>res::Tuple</code>: the result of the last behavior execution,</li><li><code>bhv::Func</code> : the behavior function and its internal arguments,</li><li><code>init::Func</code>: the init function and its arguments,</li><li><code>term::Func</code>: the terminate function and its arguments,</li><li><code>link::LINK</code>: the actors (local or remote) link.</li></ol><p>see also: <a href="../behavior/#YAActL.Dispatch"><code>Dispatch</code></a>, <a href="../messages/#YAActL.Func"><code>Func</code></a>, <a href="../api/#YAActL.LINK"><code>LINK</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/pbayer/YAActL.jl/blob/d1e97dd82da13ee40773d1cd01f9f441be357fa5/src/actors.jl#L7-L23">source</a></section></article><p>Functions executed by an actor can access their actor&#39;s internal <code>ACT</code> variable via <code>task_local_storage(&quot;ACT&quot;)</code>.  Normally this is not needed.</p><p>We must express two important concerns regarding actor state:</p><div class="admonition is-info"><header class="admonition-header">Actor state is multifaceted!</header><div class="admonition-body"><p>Actor state is not a single value but includes behavior functions, arguments and an explicit mutable state variable, which is used for <code>state</code> <a href="../behavior/#YAActL.Dispatch"><code>Dispatch</code></a> or for representing agents.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Sharing state can cause critical race conditions!</header><div class="admonition-body"><p>You must be careful <strong>not to share</strong> any of the state variables between actors in order to avoid critical <a href="https://en.wikipedia.org/wiki/Race_condition">race conditions</a>.</p></div></div><h2 id="Create-Private-Actor-State"><a class="docs-heading-anchor" href="#Create-Private-Actor-State">Create Private Actor State</a><a id="Create-Private-Actor-State-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Private-Actor-State" title="Permalink"></a></h2><p>The returned value of the <a href="../api/#YAActL.init!"><code>init!</code></a> function is saved as an actors state <code>sta</code>. It is a good practice to have an init function to create a private actor state with defined initial parameters.</p><p>Be careful to <a href="../api/#YAActL.update!"><code>update!</code></a> the actor&#39;s state since it overwrites it. Don&#39;t update it with a shared variable.</p><h2 id="Update-Actor-State"><a class="docs-heading-anchor" href="#Update-Actor-State">Update Actor State</a><a id="Update-Actor-State-1"></a><a class="docs-heading-anchor-permalink" href="#Update-Actor-State" title="Permalink"></a></h2><p>Only the actor itself is allowed to update its state in a strictly sequential manner by processing message after message.</p><p>Other actors or users can cause an actor to update its state by sending it a message, which is done implicitly by using the <a href="../api/">API</a> functions.</p><h2 id="Behavior-Function-Arguments"><a class="docs-heading-anchor" href="#Behavior-Function-Arguments">Behavior Function Arguments</a><a id="Behavior-Function-Arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Behavior-Function-Arguments" title="Permalink"></a></h2><p>Julia functions accept mutable types as parameters and  can change their values. If your behavior functions get mutable types as parameters, you must ensure that</p><ul><li>either you don&#39;t share those variables between actors</li><li>or you don&#39;t change them by using only <a href="https://en.wikipedia.org/wiki/Pure_function">pure functions</a> as behavior.</li></ul><h2 id="Global-State"><a class="docs-heading-anchor" href="#Global-State">Global State</a><a id="Global-State-1"></a><a class="docs-heading-anchor-permalink" href="#Global-State" title="Permalink"></a></h2><p>Race conditions can happen if actors in parallel use or modify global variables. The best advice is not to use global variables or at least not to share them between actors.</p><p>If for some reason you want to use global variables and share them between actors, you must use the <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Data-race-freedom">lock pattern</a> or <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Atomic-Operations">atomic operations</a> described in the Julia manual. But both approaches <strong>block</strong> an actor until it succeeds to access the variable.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>see: <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Data-race-freedom">Data-race freedom</a> in the Julia manual.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>see: <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Side-effects-and-mutable-function-arguments">Side effects and mutable function arguments</a> in the Julia manual.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../messages/">« Messages</a><a class="docs-footer-nextpage" href="../diagnosis/">Diagnosis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 13 October 2020 19:31">Tuesday 13 October 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
